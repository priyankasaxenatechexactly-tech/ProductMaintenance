@model ProductMaintenance.Models.PagedResult<ProductMaintenance.Models.UserListItem>
@{
    ViewData["Title"] = "Users";
}
<h2 class="mb-2">User Management</h2>
<div class="row g-2 mb-3 align-items-center">
    <div class="col-sm-6 col-md-6 col-lg-6">
        <a asp-action="Create" class="btn btn-primary">Create User</a>
    </div>
    <div class="col-sm-6 col-md-6 col-lg-6 text-end" id="userToolbar"></div>
    </div>

@* Inline alerts removed; messages are shown via centered toasts in _Layout.cshtml *@

<div class="table-responsive">
    <table id="userTable" class="table table-striped table-bordered align-middle">
        <thead>
            <tr>
                <th style="width:30%">Name</th>
                <th style="width:20%">Role</th>
                <th style="width:30%">Email</th>
                <th style="width:20%" class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
        @if (Model?.Items != null)
        {
            foreach (var u in Model.Items)
            {
                <tr>
                    <td>@u.Name</td>
                    <td>@u.Role</td>
                    <td>@u.Email</td>
                    <td class="text-end">
                        <a asp-action="Edit" asp-route-id="@u.Id" class="btn btn-sm btn-outline-primary me-2" title="Edit" aria-label="Edit">
                            <span class="material-icons" aria-hidden="true">edit</span>
                        </a>
                        <form asp-action="Delete" asp-route-id="@u.Id" method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this user?');" title="Delete" aria-label="Delete">
                                <span class="material-icons" aria-hidden="true">delete</span>
                            </button>
                        </form>
                    </td>
                </tr>
            }
        }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        $(function () {
            var table = $('#userTable').DataTable({
                pageLength: 10,
                lengthChange: false,
                order: [],
                columnDefs: [
                    { orderable: false, targets: -1 } // actions
                ]
            });

            // Move the DataTables search box into our toolbar right column
            var filter = $('#userTable_filter');
            if (filter.length) {
                filter.addClass('mb-0 d-inline-flex align-items-center');
                $('#userToolbar').empty().append(filter);
                // Remove any label text and keep only input
                var label = filter.find('label');
                if (label.length) {
                    label.contents().filter(function(){ return this.nodeType === Node.TEXT_NODE; }).remove();
                    label.addClass('mb-0');
                }
                // Input styling
                var input = filter.find('input');
                input.attr('placeholder', 'Search...')
                     .addClass('form-control form-control-sm')
                     .css('width', '240px');
            }
        });
    </script>
}
